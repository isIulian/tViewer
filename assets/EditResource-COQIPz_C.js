import{r as x,w as _,k as e,l as j,B as p,I as b,L as $,p as B,q as G}from"./index-PsDayEUa.js";import{z as o,u as H,a as S,F as M,b as c,c as i,d as u,e as d,f as m,g as f,t as U}from"./form-BRuEqSF8.js";import{S as N,a as T,b as C,c as F,d as P}from"./select-8kfTUmTh.js";import{I as g}from"./input-BhSdzqM9.js";import{T as X,s as J}from"./data-CfxBc-PR.js";import{r as I}from"./resourcesService-Dcwbatao.js";import{r as K}from"./resourceTypeService-VxB1GVOX.js";import{T as O}from"./theme-switch-DuQNpLzg.js";const Q=o.object({title:o.string({required_error:"Please set a resource title."}),resourceType:o.string({required_error:"Please specify the resource type."}),description:o.string({required_error:"Please wirte a short description."}),status:o.string({required_error:"Please set status."}),covers:o.array(o.object({value:o.string().url({message:"Please enter a valid URL."})})).optional(),parts:o.array(o.object({value:o.string({required_error:"Please enter a part name."})})).nonempty("At least on part is required")});function W(){const[R,w]=x.useState([]),[v,z]=x.useState(null),{id:h}=_();x.useEffect(()=>{(async()=>{let r=await K.getTypes();w(r)})()},[]),x.useEffect(()=>{(async()=>{let r=parseInt(h,10);if(!isNaN(r)){let t=await I.getResource(r);if(z(t),n("resourceType",String(t.type)),n("title",t.title),n("description",t.description),n("status",t.status),t.covers.length>0){let l=t.covers.map(y=>({value:y}));n("covers",l)}if(t.parts.length>0){let l=t.parts.map(y=>({value:y}));n("parts",l)}}})()},[h]);const a=H({resolver:U(Q),mode:"onChange"}),{setValue:n}=a,{fields:D,append:E,remove:k}=S({name:"covers",control:a.control}),{fields:q,append:V,remove:A}=S({name:"parts",control:a.control});function L(s){let r=parseInt(s.resourceType,10),t={id:parseInt(h,10),type:r,title:s.title,description:s.description,status:s.status,covers:s.covers.map(l=>l.value),parts:s.parts.map(l=>l.value)};I.updateResource(t).then(function(){window.location.href=`/tViewer/resource/${h}`})}return v===null?e.jsx("p",{children:"No details"}):e.jsx(M,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(L),className:"space-y-8",children:[e.jsx(c,{control:a.control,name:"resourceType",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Type"}),e.jsxs(N,{onValueChange:s.onChange,value:s.value,defaultValue:v.type,children:[e.jsx(d,{children:e.jsx(T,{children:e.jsx(C,{placeholder:"Select a type"})})}),e.jsx(F,{children:R.map((r,t)=>e.jsx(P,{value:String(r.id),children:r.name},t))})]}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Title"}),e.jsx(d,{children:e.jsx(g,{placeholder:"resource title/name",...s,value:s.value})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Description"}),e.jsx(d,{children:e.jsx(X,{placeholder:"Tell us about the resource",className:"resize-none",...s,value:s.value})}),e.jsx(f,{children:"Give a short description of what the resource is talking about."}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Status"}),e.jsxs(N,{onValueChange:s.onChange,value:s.value,defaultValue:v.status,children:[e.jsx(d,{children:e.jsx(T,{children:e.jsx(C,{placeholder:"Select status"})})}),e.jsx(F,{children:J.map((r,t)=>e.jsx(P,{value:r.value,children:r.label},t))})]}),e.jsx(m,{})]})}),e.jsxs("div",{children:[D.map((s,r)=>e.jsx(c,{control:a.control,name:`covers.${r}.value`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(u,{className:j(r!==0&&"sr-only"),children:"Covers"}),e.jsx(f,{className:j(r!==0&&"sr-only"),children:"Add urls of cover to the resource."}),e.jsx(d,{children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{...t}),e.jsx(p,{type:"button",variant:"ghost",className:"ml-1",size:"sm",onClick:()=>k(r),children:e.jsx(b,{size:14})})]})}),e.jsx(m,{})]})},s.id)),e.jsx(p,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>E({value:""}),children:"Add Cover"})]}),e.jsxs("div",{children:[q.map((s,r)=>e.jsx(c,{control:a.control,name:`parts.${r}.value`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(u,{className:j(r!==0&&"sr-only"),children:"Parts"}),e.jsx(f,{className:j(r!==0&&"sr-only"),children:"Add part or parts of the resource."}),e.jsx(d,{children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{...t}),e.jsx(p,{type:"button",variant:"ghost",className:"ml-1",size:"sm",onClick:()=>A(r),children:e.jsx(b,{size:14})})]})}),e.jsx(m,{})]})},s.id)),e.jsx(p,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>V({value:""}),children:"Add Part"})]}),e.jsx(p,{type:"submit",children:"Edit"})]})})}function le(){return e.jsxs($,{children:[e.jsxs(B,{className:"border-b",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Edit resource"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsx(O,{})})]}),e.jsx(G,{className:"space-y-4",children:e.jsx(W,{})})]})}export{le as default};
