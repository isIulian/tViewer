import{r as x,w as _,k as e,l as j,B as p,I as b,y as B,L as $,p as G,q as H}from"./index-BqNX3fUW.js";import{z as l,u as J,a as N,F as M,b as c,c as i,d as u,e as d,f as m,g as f,t as O}from"./form-YsUovLLL.js";import{S,a as T,b as C,c as F,d as w}from"./select-Ck-MZYYx.js";import{I as g}from"./input-B7CXuEv-.js";import{T as U,s as X}from"./data-BCQUUqfZ.js";import{r as P}from"./resourcesService-BFqxfeSL.js";import{r as Y}from"./resourceTypeService-DeumqlJe.js";import{T as K}from"./theme-switch-Dv3xt-Vd.js";const Q=l.object({title:l.string({required_error:"Please set a resource title."}),resourceType:l.string({required_error:"Please specify the resource type."}),description:l.string({required_error:"Please wirte a short description."}),status:l.string({required_error:"Please set status."}),covers:l.array(l.object({value:l.string().url({message:"Please enter a valid URL."})})).optional(),parts:l.array(l.object({value:l.string({required_error:"Please enter a part name."})})).nonempty("At least on part is required")});function W(){const[I,R]=x.useState([]),[v,z]=x.useState(null),{id:h}=_();x.useEffect(()=>{(async()=>{let r=await Y.getTypes();R(r)})()},[]),x.useEffect(()=>{(async()=>{let r=parseInt(h,10);if(!isNaN(r)){let t=await P.getResource(r);if(z(t),n("resourceType",String(t.type)),n("title",t.title),n("description",t.description),n("status",t.status),t.covers.length>0){let o=t.covers.map(y=>({value:y}));n("covers",o)}if(t.parts.length>0){let o=t.parts.map(y=>({value:y}));n("parts",o)}}})()},[h]);const a=J({resolver:O(Q),mode:"onChange"}),{setValue:n}=a,{fields:D,append:E,remove:k}=N({name:"covers",control:a.control}),{fields:q,append:A,remove:L}=N({name:"parts",control:a.control});function V(s){let r=parseInt(s.resourceType,10),t={id:parseInt(h,10),type:r,title:s.title,description:s.description,status:s.status,covers:s.covers.map(o=>o.value),parts:s.parts.map(o=>o.value)};P.updateResource(t).then(function(){window.location.href=`/resource/${h}`}),B({title:"You submitted the following values:",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(s,null,2)})})})}return v===null?e.jsx("p",{children:"No details"}):e.jsx(M,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(V),className:"space-y-8",children:[e.jsx(c,{control:a.control,name:"resourceType",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Type"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,defaultValue:v.type,children:[e.jsx(d,{children:e.jsx(T,{children:e.jsx(C,{placeholder:"Select a type"})})}),e.jsx(F,{children:I.map((r,t)=>e.jsx(w,{value:String(r.id),children:r.name},t))})]}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Title"}),e.jsx(d,{children:e.jsx(g,{placeholder:"resource title/name",...s,value:s.value})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Description"}),e.jsx(d,{children:e.jsx(U,{placeholder:"Tell us about the resource",className:"resize-none",...s,value:s.value})}),e.jsx(f,{children:"Give a short description of what the resource is talking about."}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(u,{children:"Status"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,defaultValue:v.status,children:[e.jsx(d,{children:e.jsx(T,{children:e.jsx(C,{placeholder:"Select status"})})}),e.jsx(F,{children:X.map((r,t)=>e.jsx(w,{value:r.value,children:r.label},t))})]}),e.jsx(m,{})]})}),e.jsxs("div",{children:[D.map((s,r)=>e.jsx(c,{control:a.control,name:`covers.${r}.value`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(u,{className:j(r!==0&&"sr-only"),children:"Covers"}),e.jsx(f,{className:j(r!==0&&"sr-only"),children:"Add urls of cover to the resource."}),e.jsx(d,{children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{...t}),e.jsx(p,{type:"button",variant:"ghost",className:"ml-1",size:"sm",onClick:()=>k(r),children:e.jsx(b,{size:14})})]})}),e.jsx(m,{})]})},s.id)),e.jsx(p,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>E({value:""}),children:"Add Cover"})]}),e.jsxs("div",{children:[q.map((s,r)=>e.jsx(c,{control:a.control,name:`parts.${r}.value`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(u,{className:j(r!==0&&"sr-only"),children:"Parts"}),e.jsx(f,{className:j(r!==0&&"sr-only"),children:"Add part or parts of the resource."}),e.jsx(d,{children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{...t}),e.jsx(p,{type:"button",variant:"ghost",className:"ml-1",size:"sm",onClick:()=>L(r),children:e.jsx(b,{size:14})})]})}),e.jsx(m,{})]})},s.id)),e.jsx(p,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>A({value:""}),children:"Add Part"})]}),e.jsx(p,{type:"submit",children:"Edit"})]})})}function ne(){return e.jsxs($,{children:[e.jsxs(G,{className:"border-b",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Edit resource"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsx(K,{})})]}),e.jsx(H,{className:"space-y-4",children:e.jsx(W,{})})]})}export{ne as default};
